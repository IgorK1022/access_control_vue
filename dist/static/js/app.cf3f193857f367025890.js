webpackJsonp([7],{KNYN:function(e,n){},NHnr:function(e,n,t){"use strict";function r(e){t("KNYN")}Object.defineProperty(n,"__esModule",{value:!0});var a=t("+BS6"),o=t("bcLl"),i=t.n(o),u=(t("VhbW"),t("UIuv")),c=t.n(u),s=t("gyMJ"),l={data:function(){return{children:null}},beforeRouteEnter:function(e,n,t){t(function(e){var n=e.$route.meta.children;e.children=n||null})},watch:{$route:function(e,n){var t=this.$route.meta.children;this.children=t||null}}},f=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",[e.children?t("el-row",{attrs:{gutter:20}},e._l(e.children,function(n,r){return t("el-col",{key:r,attrs:{span:4}},[t("el-card",[t("div",{staticClass:"text"},[t("p",[e._v(e._s(n.name))]),e._v(" "),t("router-link",{attrs:{to:{name:n.name}}},[e._v("查看")])],1)])],1)})):e._e(),e._v(" "),t("router-view")],1)},h=[],p={render:f,staticRenderFns:h},d=p,m=t("XAIM"),g=m(l,d,!1,null,null,null),v=g.exports,y=[{path:"/",name:"首页",component:function(e){return t.e(2).then(function(){var n=[t("8hXn")];e.apply(null,n)}.bind(this)).catch(t.oe)},children:[{path:"/roles",name:"平台-角色管理",meta:{name:"角色管理"},component:function(e){return t.e(4).then(function(){var n=[t("1XJF")];e.apply(null,n)}.bind(this)).catch(t.oe)}},{path:"/accounts",name:"平台-账号管理",meta:{name:"账号管理"},component:function(e){return t.e(3).then(function(){var n=[t("jk0N")];e.apply(null,n)}.bind(this)).catch(t.oe)}},{path:"/goods",name:"商品管理",meta:{icon:"&#xe62e;"},component:v,children:[{path:"list",name:"商品信息",meta:{},component:function(e){return t.e(1).then(function(){var n=[t("8dlZ")];e.apply(null,n)}.bind(this)).catch(t.oe)}}]}]}],b=t("mt/N"),A=void 0,$={data:function(){return{menuData:null,userData:null}},methods:{getPermission:function(e){var n={};return Array.isArray(e.resources)&&e.resources.forEach(function(e,t){var r=e.method.toLowerCase()+","+e.url;n[r]=!0}),n},setInterceptor:function(e){var n=this;A=s.a.interceptors.request.use(function(t){var r=t.url.replace(t.baseURL,"").replace("/GET","").replace("/POST","").split("?")[0],a=r.match(/^(\/[^\/]+\/)[^\/]+$/);a&&(r=a[1]+"**");var o=r.match(/^\/[^\/]+\/([^\/]+)\/[^\/]+$/);return o&&(r=r.replace(o[1],"*")),e[t.method+","+r]?t:(console.warn(e,t.method+","+r),n.$message({message:"无访问权限，请联系企业管理员",type:"warning"}),c.a.reject({message:"no permission"}))})},getRoutes:function(e){if(!e.menus)return console.warn(e);var n=[],t=b.a(e.menus),r={};!function e(n,t){n.map(function(n){if(n.route){var a=((t?t+"/":"")+n.route).replace(/^\//,"");r["/"+a]=!0,Array.isArray(n.children)&&e(n.children,n.route)}})}(t);var a=b.c(y[0].children);return function e(t,a){var o=[];if(t.forEach(function(n){var t=(a?a+"/":"")+n.path;r[t]&&(Array.isArray(n.children)&&(n.children=e(n.children,n.path)),o.push(n))}),a)return o;n=n.concat(o)}(a),n},extendRoutes:function(e){var n=this,t=b.c(y);t[0].children=e,n.$router.addRoutes(t.concat([{path:"*",redirect:"/404"}]))},storageMenu:function(e){e.forEach(function(e){e.children&&(e.meta||(e.meta={}),e.meta.children=e.children)}),this.menuData=e},signin:function(e){var n=this,t=b.d("token");if(!t||!t.token)return n.$router.push({path:"/login",query:{from:n.$router.currentRoute.path}});s.a.defaults.headers.common.Authorization="Bearer "+t.token,s.a.get("/GET/signin",{params:{Authorization:t.token}}).then(function(t){var r=t.data,o=n.getPermission(r);n.setInterceptor(o);var i=n.getRoutes(r);if(!i||!i.length)return b.d("token",""),document.body.innerHTML="<h1>账号访问受限，请联系系统管理员！</h1>";n.extendRoutes(i),n.storageMenu(i),n.userData=r,a.default.prototype.$_has=function(e){var n=[],t=!0;return Array.isArray(e)?e.forEach(function(e){n=n.concat(e.p)}):n=n.concat(e.p),n.forEach(function(e){if(!o[e])return t=!1}),t},"function"==typeof e&&e()})},loginDirect:function(e){var n=this;this.signin(function(){n.$router.replace({path:e||"/"})})},logoutDirect:function(){s.a.interceptors.request.eject(A),this.$router.replace({path:"/login"})}},created:function(e){this.signin()}},w=function(){var e=this,n=e.$createElement;return(e._self._c||n)("router-view",{attrs:{id:"app"},on:{login:e.loginDirect,logout:e.logoutDirect}})},E=[],_={render:w,staticRenderFns:E},k=_,N=t("XAIM"),R=r,S=N($,k,!1,R,null,null),I=S.exports,M=t("YaEn");a.default.use(i.a),a.default.directive("has",{bind:function(e,n){a.default.prototype.$_has(n.value)||e.parentNode.removeChild(e)}}),new a.default({el:"#app",router:M.a,render:function(e){return e(I)}})},VhbW:function(e,n){},YaEn:function(e,n,t){"use strict";var r=t("+BS6"),a=t("1eSk");r.default.use(a.a);var o=[{path:"/login",name:"login",component:function(e){return t.e(0).then(function(){var n=[t("Quw4")];e.apply(null,n)}.bind(this)).catch(t.oe)}},{path:"/404",name:"404",component:function(e){return t.e(5).then(function(){var n=[t("7FDS")];e.apply(null,n)}.bind(this)).catch(t.oe)}}],i=new a.a({routes:o});i.beforeEach(function(e,n,t){var r=e.meta.name||e.name;window.document.title=(r?r+" - ":"")+"药盟·会员管理系统",t()}),n.a=i},gyMJ:function(e,n,t){"use strict";var r=t("gCy3"),a=t.n(r),o=(t("YaEn"),t("mt/N")),i=a.a.create({baseURL:"http://rap2api.taobao.org/app/mock/224",timeout:1e4});i.defaults.headers.post["Content-Type"]="application/json",i.interceptors.response.use(function(e){return e},o.b),n.a=i},"mt/N":function(e,n,t){"use strict";t.d(n,"d",function(){return f}),t.d(n,"c",function(){return h}),t.d(n,"a",function(){return p}),t.d(n,"b",function(){return d});var r=t("UIuv"),a=t.n(r),o=t("3SZ7"),i=t.n(o),u=t("GxZn"),c=t.n(u),s=t("+BS6"),l=t("bcLl");t.n(l);s.default.component(l.Message.name,l.Message);var f=function(e,n){if(void 0===n){var t=sessionStorage.getItem(e);return t&&0===t.indexOf("autostringify-")?JSON.parse(t.split("autostringify-")[1]):t}return("object"===(void 0===n?"undefined":c()(n))||Array.isArray(n))&&(n="autostringify-"+i()(n)),sessionStorage.setItem(e,n)},h=function e(n){if(!n)return n;var t=n instanceof Array?[]:{};for(var r in n)t[r]="object"===c()(n[r])?e(n[r]):n[r];return t},p=function(e,n){var t=[],r=Array.isArray(e)?e.map(function(e){return e.id}):[];n=n||"parent_id",e.forEach(function(e,a){if(e[n]&&e[n]!==e.id){if(Array.isArray(r)){var o=r.findIndex(function(t){return t==e[n]});-1===o&&t.push(e)}}else delete e[n],t.push(h(e))});return function t(r){Array.isArray(r)&&r.length&&r.forEach(function(r){e.forEach(function(e){r.id===e[n]&&(r.children?r.children.push(e):r.children=[e])}),r.children&&t(r.children)})}(t),t},d=function(e){if(e.response)switch(e.response.status){case 400:s.default.prototype.$message({message:e.response.data.message||"请求参数异常",type:"error"});break;case 401:sessionStorage.removeItem("user"),s.default.prototype.$message({message:e.response.data.message||"密码错误或账号不存在！",type:"warning",onClose:function(){location.reload()}});break;case 403:s.default.prototype.$message({message:e.response.data.message||"无访问权限，请联系企业管理员",type:"warning"});break;default:s.default.prototype.$message({message:e.response.data.message||"服务端异常，请联系技术支持",type:"error"})}return a.a.reject(e)}}},["NHnr"]);
//# sourceMappingURL=app.cf3f193857f367025890.js.map